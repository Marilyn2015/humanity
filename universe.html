<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>#HUMANITY Universe</title>
  <!-- Firebase & Three.js -->
  <script src="https://unpkg.com/three@0.128.0/build/three.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
  <style>
    body { font-family: 'Roboto', sans-serif; background: #080c19; color: #fff; margin: 0; padding: 0; min-height: 100vh; overflow-x: hidden; text-align: center; }
    #star-bg { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 0; }
    .tabs { position: absolute; top: 16px; left: 0; width: 100%; display: flex; justify-content: space-between; padding: 0 16px; z-index: 200; }
    .tab { padding: 9px 24px; font-size: 1.08rem; background: linear-gradient(90deg, #fff 0%, #e9e9e9 100%); color: #191919; text-decoration: none; box-shadow: 0 0 20px 4px #ffffffd0, 0 2px 16px #0009; transition: 0.2s; border-radius: 4px; }
    .tab:hover { background: linear-gradient(90deg, #fff 0%, #ffbdbd 100%); color: #a20000; }
    .globe-glow { display: flex; justify-content: center; align-items: center; margin: 32px auto 16px; width: 400px; height: 400px; position: relative; z-index: 2; }
    #globeCanvas { width: 400px; height: 400px; background: transparent; position: absolute; left: 0; top: 0; z-index: 2; }
    #openModal { margin: 16px auto; padding: 10px 28px; font-size: 1.1rem; z-index: 2; background: linear-gradient(90deg, #00eaff, #007f8a); color: #191919; border: none; box-shadow: 0 0 22px 6px #00eaff66, 0 2px 18px #0009; cursor: pointer; border-radius: 4px; transition: transform 0.2s, box-shadow 0.2s; }
    #openModal:hover { transform: translateY(-2px); box-shadow: 0 0 32px 8px #00eaff99; }
    h1 { font-size: 2.4rem; letter-spacing: 2px; margin: 12px 0; z-index: 2; position: relative; }
    .modal-blur { display: none; position: fixed; inset: 0; background: rgba(10,30,44,0.75); backdrop-filter: blur(6px); z-index: 900; }
    .modal-blur.active { display: block; }
    .modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1000; background: #1f2733; padding: 24px; width: 90%; max-width: 460px; border-radius: 8px; box-shadow: 0 8px 24px rgba(0,0,0,0.7), 0 0 12px #00eaff33; }
    .modal.active { display: flex; flex-direction: column; align-items: center; justify-content: center; }
    .modal textarea, .modal input[type=file] { width: 100%; max-width: 420px; margin: 12px auto; padding: 12px; border-radius: 4px; border: 1px solid #444; background: #2a2f36; color: #fff; font-size: 1rem; }
    .modal textarea { height: 100px; resize: vertical; }
    .modal .actions { display: flex; justify-content: center; gap: 12px; margin-top: 16px; }
    .modal .actions button { padding: 10px 24px; border: none; border-radius: 4px; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
    .modal .actions #postButton { background: linear-gradient(90deg, #00eaff, #007f8a); color: #1b1b1b; box-shadow: 0 0 12px #00eaff, 0 0 6px #00eaff33; }
    .modal .actions #postButton:hover { transform: translateY(-3px); box-shadow: 0 0 16px #00eaff, 0 0 8px #00eaff66; }
    .modal .actions #closeModal { background: linear-gradient(90deg, #ff5e5e, #c43b3b); color: #fff; box-shadow: 0 0 12px #ff5e5e, 0 0 6px #ff5e5333; }
    .modal .actions #closeModal:hover { transform: translateY(-3px); box-shadow: 0 0 16px #ff5e5e, 0 0 8px #ff5e5666; }
    .post-item {
      background: #2e2e2e;
      border: 1px solid #222;
      padding: 12px 24px; /* reduced vertical padding */
      margin: 12px auto;    /* slightly smaller margin */
      width: 85%;
      max-width: 480px;
      text-align: left;
      display: flex;
      flex-direction: column;
      box-shadow: 0 4px 18px #00f6ff7a, 0 2px 16px #000b;
      position: relative;
      gap: 4px;           /* reduced gap between elements */
      z-index: 2;
    }
    .post-header { display: flex; align-items: center; gap: 12px; }
    .post-item img.avatar { width: 46px; height: 46px; border-radius: 24px; border:2px solid #333; object-fit: cover; }
    .post-user { font-weight: bold; font-size: 1.07rem; }
    .post-date { color: #aaa; font-size: .87rem; margin-left:4px; }
    .post-item img.uploaded { max-width:100%; border-radius:4px; margin-top:10px; border:1px solid #222; box-shadow:0 0 8px #00e4fa66; }
    .post-content { margin:12px 0; }
    .post-actions { display:flex; align-items:center; gap:12px; margin-top:8px; }
    .like-btn, .delete-btn { padding:8px 16px; background:linear-gradient(90deg,#fff 0%,#ededed 100%); color:#18181b; border:none; border-radius:4px; cursor:pointer; box-shadow:0 0 8px #fff9; font-size:1rem; }
    .like-btn.liked { background:#fff; color:#e81c4f; box-shadow:0 0 12px #fff; }
    .like-btn:hover, .delete-btn:hover { background:linear-gradient(90deg,#fff 0%,#ffbdbd 100%); color:#a20000; }
    .error-banner { background:#ff6870; color:#fff; font-weight:600; padding:8px 0; margin-bottom:10px; width:100%; display:none; z-index: 10; }
  </style>
</head>
<body>
  <canvas id="star-bg"></canvas>
  <div class="tabs">
    <a class="tab" href="view_profile.html">My Profile</a>
    <a class="tab" href="login.html">Logout</a>
  </div>
  <div class="globe-glow"><canvas id="globeCanvas"></canvas></div>
  <button id="openModal">New Post</button>
  <h1>The Universe</h1>
  <div id="modalBlur" class="modal-blur"></div>
  <div id="postModal" class="modal">
    <textarea id="newPostContent" placeholder="What's on your mind?"></textarea>
    <input type="file" id="postImageUpload" accept="image/*"/>
    <div class="actions">
      <button id="closeModal">Cancel</button>
      <button id="postButton">Post</button>
    </div>
  </div>
  <div id="errorBanner" class="error-banner"></div>
  <div id="postsContainer"></div>
  <script>
    // === ERROR BANNER ===
    const errorBanner = document.getElementById('errorBanner');
    function showError(msg) { errorBanner.innerText = msg; errorBanner.style.display = 'block'; setTimeout(() => errorBanner.style.display = 'none', 4000); }

    // === STAR FIELD ===
    const starCanvas = document.getElementById('star-bg');
    const ctx = starCanvas.getContext('2d');
    let stars = [];
    function resizeCanvas() { starCanvas.width = window.innerWidth; starCanvas.height = window.innerHeight; }
    function initStars() { resizeCanvas(); stars = []; const count = Math.floor(window.innerWidth * window.innerHeight / 2000); for (let i = 0; i < count; i++) stars.push({ x: Math.random()*starCanvas.width, y: Math.random()*starCanvas.height, r: Math.random()*1.2+0.3, baseO: Math.random()*0.7+0.2 }); }
    window.addEventListener('resize', initStars);
    initStars();
    function animateStars() { ctx.clearRect(0,0,starCanvas.width,starCanvas.height); stars.forEach(s=>{ const o=Math.min(1,Math.max(0,s.baseO + (Math.random()*0.4-0.2))); ctx.globalAlpha=o; ctx.beginPath(); ctx.arc(s.x,s.y,s.r,0,2*Math.PI); ctx.fillStyle='#fff'; ctx.fill(); }); requestAnimationFrame(animateStars); }
    animateStars();

    // ---- 3D Globe ----
    const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('globeCanvas'), alpha: true }); renderer.setSize(400,400);
    const scene = new THREE.Scene(); const camera = new THREE.PerspectiveCamera(50,1,0.1,1000); camera.position.z=3;
    new THREE.TextureLoader().load('https://threejs.org/examples/textures/land_ocean_ice_cloud_2048.jpg', tex=>{ const sphere = new THREE.Mesh(new THREE.SphereGeometry(1,32,32), new THREE.MeshStandardMaterial({ map: tex })); scene.add(sphere); const light = new THREE.DirectionalLight(0xffffff,1); light.position.set(5,3,5); scene.add(light); (function animate(){ requestAnimationFrame(animate); sphere.rotation.y+=0.002; renderer.render(scene,camera); })(); });

    // === FIREBASE FEED LOGIC ===
    const currentUser = { username: 'Marilyn', avatar: 'https://randomuser.me/api/portraits/women/44.jpg' };
    const firebaseConfig = { apiKey:'AIzaSyBT7...', authDomain:'hashhumanity-58b9a.firebaseapp.com', databaseURL:'https://hashhumanity-58b9a-default-rtdb.firebaseio.com', storageBucket:'hashhumanity-58b9a.appspot.com', projectId:'hashhumanity-58b9a', messagingSenderId:'886745899016', appId:'1:886745899016:web:...'};
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database(), storage = firebase.storage(), postsContainer = document.getElementById('postsContainer');
    function displayPost(id,data){ const el=document.createElement('div'); el.className='post-item'; const hd=document.createElement('div'); hd.className='post-header'; const av=document.createElement('img'); av.className='avatar'; av.src=data.avatar; hd.append(av); const un=document.createElement('span'); un.className='post-user'; un.innerText=data.username; hd.append(un); const dt=document.createElement('span'); dt.className='post-date'; dt.innerText=' â€¢ '+new Date(data.timestamp).toLocaleString(); hd.append(dt); el.append(hd); const txt=document.createElement('div'); txt.className='post-content'; txt.innerHTML=data.content; el.append(txt); if(data.imageUrl){ const img=document.createElement('img'); img.className='uploaded'; img.src=data.imageUrl; el.append(img); } const acts=document.createElement('div'); acts.className='post-actions'; const lk=document.createElement('button'); lk.className='like-btn'; lk.innerHTML='â¤ï¸'; acts.append(lk); if(data.username===currentUser.username){ const dbtn=document.createElement('button'); dbtn.className='delete-btn'; dbtn.innerHTML='ðŸ—‘'; dbtn.onclick=()=>db.ref('posts/'+id).remove(); acts.append(dbtn);} el.append(acts); postsContainer.prepend(el); }
    // === Load existing posts and listen for new ones ===
    postsContainer.innerHTML = '';
    db.ref('posts').orderByChild('timestamp').on('child_added', snapshot => {
      const post = snapshot.val();
      const id = snapshot.key;
      displayPost(id, post);
    });

    // === MODAL HANDLERS & POST CREATION ===
    const openBtnEl=document.getElementById('openModal'), blurEl=document.getElementById('modalBlur'), modalEl=document.getElementById('postModal'), closeEl=document.getElementById('closeModal');
    openBtnEl.onclick=()=>{ blurEl.classList.add('active'); modalEl.classList.add('active'); };
    closeEl.onclick=()=>{ blurEl.classList.remove('active'); modalEl.classList.remove('active'); };
    blurEl.onclick=closeEl.onclick;
    document.getElementById('postButton').onclick = async () => {
      const content = document.getElementById('newPostContent').value.trim();
      const file = document.getElementById('postImageUpload').files[0];
      if (!content && !file) {
        showError('Please add text or image');
        return;
      }
      const username = currentUser && currentUser.username ? currentUser.username : 'Anonymous';
      const avatarUrl = currentUser && currentUser.avatar ? currentUser.avatar : 'https://www.gravatar.com/avatar/?d=mp';
      let imgUrl = '';
      if (file) {
        const ref = storage.ref('posts/' + Date.now() + '_' + file.name);
        await ref.put(file);
        imgUrl = await ref.getDownloadURL();
      }
      await db.ref('posts').push({ username, avatar: avatarUrl, content, imageUrl: imgUrl, timestamp: Date.now() });
      closeEl.onclick();
      document.getElementById('newPostContent').value = '';
      document.getElementById('postImageUpload').value = '';
    };
  </script>
</body>
</html>
